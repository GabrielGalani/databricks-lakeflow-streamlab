bundle:
  name: olist-data-platform

variables:
  catalog:
    description: Cat√°logo do Unity Catalog
    default: main
  schema:
    description: Schema de destino para as tabelas Olist
    default: olist_dev

targets:
  dev:
    default: true
    workspace:
      host: https://dbc-0856e78c-d501.cloud.databricks.net

resources:
  pipelines:
    olist_pipeline:
      name: "[${bundle.target}] Olist Medallion Pipeline"
      target: ${var.schema}
      catalog: ${var.catalog}
      libraries:
        - file: ./pipelines/bronze
        - file: ./pipelines/silver
        - file: ./pipelines/gold
        - file: ./pipelines/cdc
      
      configuration:
        pipelines.usePremiumFeatures: "true"
      
      clusters:
        - label: default
          autoscale:
            min_workers: 1
            max_workers: 3
          custom_tags:
            project: portfolio-olist

  jobs:
    initial_setup:
      name: "[${bundle.target}] Olist Infrastructure Setup"
      tasks:
        - task_key: run_setup_scripts
          spark_python_task:
            python_file: ./setup/run.py